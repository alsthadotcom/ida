# UI Components to Database Column Mapping

This document provides a comprehensive mapping of all UI components, fields, and buttons to their corresponding database columns in the IDA Marketplace application.

---

## **Profile Page** (`src/entries/profile.tsx`)

### Display Fields
| UI Component | Database Column | Table | Editable | Notes |
|-------------|-----------------|-------|----------|-------|
| Name (header display) | `name` | `user_info` | ❌ No | Shows user's full name |
| Name (input field) | `name` | `user_info` | ❌ No | Read-only field |
| Email Address | `email` | `user_info` | ❌ No | Read-only, unique constraint |
| Username (display) | `username` | `user_info` | ✅ Yes | Shown as @username |
| Username (input field) | `username` | `user_info` | ✅ Yes | Editable, unique, format: `@[a-z0-9]+` |

### Actions
- **Save Changes Button** → Updates `username` in `user_info` table via `updateUserUsername()` function

---

## **Sell Idea Page** (`components/SellIdea.tsx`)

### Basic Information
| UI Component | Database Column | Table | Required | Notes |
|-------------|-----------------|-------|----------|-------|
| Listing Title | `title` | `idea_listing` | ✅ Yes | Main idea title |
| Description | `description` | `idea_listing` | ✅ Yes | Detailed description |
| User ID (hidden) | `user_id` | `idea_listing` | ✅ Yes | Foreign key to `user_info.user_id` |

### Document Uploads
| UI Component | Database Column | Table | Required | Notes |
|-------------|-----------------|-------|----------|-------|
| Primary Document (PDF) | `document_url` | `idea_listing` | ✅ Yes | Main business document |
| Additional Document 1 | `additional_doc_1` | `idea_listing` | ❌ No | Optional supporting doc |
| Additional Document 2 | `additional_doc_2` | `idea_listing` | ❌ No | Optional supporting doc |
| Additional Document 3 | `additional_doc_3` | `idea_listing` | ❌ No | Optional supporting doc |

### MVP Information
| UI Component | Database Column | Table | Required | Notes |
|-------------|-----------------|-------|----------|-------|
| Has MVP (Yes/No toggle) | `mvp` | `idea_listing` | ✅ Yes | Boolean field |
| MVP Type (Physical/Digital) | `mvp_type` | `idea_listing` | Conditional | Required if `mvp = true` |
| Digital MVP URL | `digital_mvp` | `idea_listing` | Conditional | Required if `mvp_type = 'Digital/Saas'` |
| Physical MVP Image | `physical_mvp_image` | `idea_listing` | ❌ No | Image upload for physical products |
| Physical MVP Video | `physical_mvp_video` | `idea_listing` | ❌ No | Video upload for physical products |

### Pricing
| UI Component | Database Column | Table | Required | Notes |
|-------------|-----------------|-------|----------|-------|
| Asking Price | `price` | `idea_listing` | ✅ Yes | Decimal(10,2), dynamic limit based on scores |

### AI Scoring Display (Read-Only)
| UI Component | Database Column | Table | Generated By | Notes |
|-------------|-----------------|-------|--------------|-------|
| Uniqueness Score (0-100) | `uniqueness` | `ai_scoring` | AI Analysis | Circular progress indicator |
| Demand Level | `demand` | `ai_scoring` | AI Analysis | Values: Low, Low-Mid, Mid, Mid-High, High |
| Problem Impact Score (0-100) | `problem_impact` | `ai_scoring` | AI Analysis | Circular progress indicator |
| Profitability (Revenue/Profit/Margin) | `profitability` | `ai_scoring` | AI Analysis | Stored as TEXT, displayed as structured data |
| Viability Score (0-100) | `viability` | `ai_scoring` | AI Analysis | Circular progress indicator |
| Scalability Score (0-100) | `scalability` | `ai_scoring` | AI Analysis | Circular progress indicator |
| Idea ID (hidden) | `idea_id` | `ai_scoring` | System | Foreign key to `idea_listing.idea_id` |

### Actions
- **Publish Listing Button** → Creates records in both `idea_listing` and `ai_scoring` tables

---

## **Marketplace Page** (`components/Marketplace.tsx`)

Uses the **`marketplace` VIEW** (joins `idea_listing`, `user_info`, and `ai_scoring`)

### Idea Cards Display
| UI Component | Database Column | View/Table | Notes |
|-------------|-----------------|------------|-------|
| Idea Title | `title` | `marketplace` view | Clickable link to details |
| Description Preview | `description` | `marketplace` view | Truncated text |
| Price | `price` | `marketplace` view | Formatted as currency |
| Seller Username | `username` | `marketplace` view | From `user_info` |
| Uniqueness Score | `uniqueness` | `marketplace` view | From `ai_scoring` |
| Demand Level | `demand` | `marketplace` view | From `ai_scoring` |
| Problem Impact | `problem_impact` | `marketplace` view | From `ai_scoring` |
| Viability | `viability` | `marketplace` view | From `ai_scoring` |
| Scalability | `scalability` | `marketplace` view | From `ai_scoring` |
| Created Date | `created_at` | `marketplace` view | Timestamp |

### Filters & Search
- **Search Bar** → Filters by `title` and `description`
- **Category Filter** → (To be implemented)
- **Price Range Filter** → Filters by `price`

---

## **Item Details Page** (`components/ItemDetails.tsx`)

Uses the **`idea_detail_page` VIEW** (comprehensive join of all related tables)

### Header Section
| UI Component | Database Column | View/Table | Notes |
|-------------|-----------------|------------|-------|
| Idea Title | `title` | `idea_detail_page` view | Main heading |
| Price | `price` | `idea_detail_page` view | Large display |
| Seller Name | `seller_name` | `idea_detail_page` view | From `user_info.name` |
| Seller Username | `seller_username` | `idea_detail_page` view | From `user_info.username` |

### Content Section
| UI Component | Database Column | View/Table | Notes |
|-------------|-----------------|------------|-------|
| Description | `description` | `idea_detail_page` view | Full text |
| Main Document Link | `document_url` | `idea_detail_page` view | PDF download |
| Additional Doc 1 Link | `additional_doc_1` | `idea_detail_page` view | Optional PDF |
| Additional Doc 2 Link | `additional_doc_2` | `idea_detail_page` view | Optional PDF |
| Additional Doc 3 Link | `additional_doc_3` | `idea_detail_page` view | Optional PDF |

### MVP Section
| UI Component | Database Column | View/Table | Notes |
|-------------|-----------------|------------|-------|
| MVP Badge/Status | `mvp` | `idea_detail_page` view | Boolean display |
| MVP Type Label | `mvp_type` | `idea_detail_page` view | Physical or Digital/Saas |
| Digital MVP Link | `digital_mvp` | `idea_detail_page` view | URL if digital |
| Physical MVP Image | `physical_mvp_image` | `idea_detail_page` view | Image display |
| Physical MVP Video | `physical_mvp_video` | `idea_detail_page` view | Video player |

### AI Scoring Section
| UI Component | Database Column | View/Table | Notes |
|-------------|-----------------|------------|-------|
| All 6 AI Metrics | All `ai_scoring` columns | `idea_detail_page` view | Same as Sell Idea display |

### Actions
- **Buy/Contact Button** → (To be implemented - transaction system)

---

## **Navigation Bar** (`components/NavBar.tsx`)

| UI Component | Database Column | Table | Notes |
|-------------|-----------------|-------|-------|
| User Display Name | `email` | Supabase Auth | **Should be updated to use `name` from `user_info`** |
| Profile Link | - | - | Routes to `/pages/profile.html` |
| Logout Button | - | - | Clears Supabase auth session |

---

## **Sign Up Page** (`components/SignUp.tsx`)

| UI Component | Database Column | Table | Notes |
|-------------|-----------------|-------|-------|
| First Name + Last Name | `name` | `user_info` | Combined into single field |
| Email | `email` | `user_info` | Unique constraint |
| Username | `username` | `user_info` | Unique, format: `@[a-z0-9]+` |
| Password | - | Supabase Auth | Not stored in `user_info` |

### Actions
- **Sign Up Button** → Creates user in Supabase Auth + creates record in `user_info` table via `ensureUserInfoExists()`

---

## **Login Page** (`components/Login.tsx`)

| UI Component | Database Column | Table | Notes |
|-------------|-----------------|-------|-------|
| Email | `email` | Supabase Auth | Used for authentication |
| Password | - | Supabase Auth | Hashed password |

### Actions
- **Login Button** → Authenticates via Supabase Auth, then syncs with `user_info` table

---

## **Database Schema Overview**

### Tables
1. **`user_info`** - User profile information
2. **`idea_listing`** - Ideas for sale
3. **`ai_scoring`** - AI-generated scores for ideas

### Views
1. **`marketplace`** - Joined view for marketplace listing page
2. **`idea_detail_page`** - Comprehensive view for idea details page

### Key Relationships
```
user_info.user_id (PK)
    ↓
idea_listing.user_id (FK)
    ↓
ai_scoring.idea_id (FK) ← idea_listing.idea_id (PK)
```

---

## **Constraints & Validations**

### `user_info` Table
- `email` - UNIQUE, NOT NULL
- `username` - UNIQUE, NOT NULL, CHECK (`username ~ '^@[a-z0-9]+$'`)
- `name` - NOT NULL

### `idea_listing` Table
- `price` - CHECK (`price >= 0`)
- `mvp_type` - CHECK (`mvp_type IN ('Digital/Saas', 'Physical')`)
- If `mvp = TRUE`, then `mvp_type` must be set
- If `mvp_type = 'Digital/Saas'`, then `digital_mvp` must be set

### `ai_scoring` Table
- All score fields (uniqueness, problem_impact, viability, scalability) - Range 0-100
- `demand` - CHECK (`demand IN ('Low', 'Low-Mid', 'Mid', 'Mid-High', 'High')`)

---

## **File Upload Mappings**

| UI Upload Field | Storage Bucket | Database Column | File Type |
|----------------|----------------|-----------------|-----------|
| Primary Document | `documents` | `document_url` | PDF |
| Additional Docs | `documents` | `additional_doc_1/2/3` | PDF |
| Physical MVP Image | `mvp-images` | `physical_mvp_image` | Image (jpg, png, etc.) |
| Physical MVP Video | `mvp-videos` | `physical_mvp_video` | Video (mp4, etc.) |

---

## **API Functions Reference**

### User Info Operations (`services/database.ts`)
- `createUserInfo()` - Create new user record
- `getUserInfoByEmail()` - Fetch user by email
- `getUserInfoByUsername()` - Fetch user by username
- `getUserInfoById()` - Fetch user by ID
- `updateUserUsername()` - Update username (with uniqueness check)
- `ensureUserInfoExists()` - Auto-create user_info on first login

### Idea Listing Operations
- `createIdeaListing()` - Create new idea listing
- `getIdeaListingById()` - Fetch idea by ID
- `getAllIdeaListings()` - Fetch all ideas (marketplace)
- `getUserIdeaListings()` - Fetch user's own ideas

### AI Scoring Operations
- `createAIScoring()` - Save AI analysis results
- `getAIScoringByIdeaId()` - Fetch scores for an idea

### File Upload Operations
- `uploadDocument()` - Upload file to Supabase Storage

---

**Last Updated:** December 9, 2025  
**Version:** 1.0
